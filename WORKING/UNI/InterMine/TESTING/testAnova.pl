#!/usr/bin/perl -w

use strict;
use warnings;

use Statistics::TTest;
use Statistics::ANOVA 0.08;
my $aov = Statistics::ANOVA->new();

my %datasets = ();

@{$datasets{a}[0]} = (0.722466024,0.925999419,1,1.049630768,1.056583528,1.10433666,1.13093087,1.150559677,1.220329955,1.316145742,1.333423734,1.63691458,1.691534165,0.713695815,0.815575429,0.918386234,0.925999419,0.941106311,0.948600847,0.970853654,0.98550043,0.98550043,1,1.028569152,1.042644337,1.10433666,1.117695043,1.269033146,1.286881148,1.298658316,1.575312331);
@{$datasets{a}[1]} = (-0.49410907,-0.358453971,-0.321928095,-0.286304185,-0.200912694,-0.200912694,-0.168122759,-0.120294234,-0.120294234,-0.104697379,-0.104697379,-0.074000581,-0.058893689,-0.577766999,-0.514573173,-0.514573173,-0.49410907,-0.358453971,-0.358453971,-0.304006187,-0.251538767,-0.184424571);

@{$datasets{b}[0]} = (-0.434402824,-0.286304185,-0.251538767,-0.058893689,-0.043943348,-0.043943348,0.084064265,0.163498732,0.23878686,0.23878686,0.310340121,0.839959587,0.879705766,-0.556393349,-0.268816758,-0.251538767,-0.152003093,-0.104697379,-0.089267338,-0.029146346,-0.029146346,0,0.070389328,0.084064265,0.097610797,0.124328135,0.137503524,0.189033824,0.189033824,0.214124805,0.214124805,0.214124805,0.321928095,0.333423734,0.367371066,0.40053793,0.411426246,0.443606651,0.516015147,0.669026766,0.713695815);
@{$datasets{b}[1]} = (0.782408565,0.799087306,0.82374936,0.887525271,0.925999419,0.933572638,0.956056652,0.97819563,0.98550043,1.021479727,1.084064265,1.097610797,1.13093087,1.150559677,1.15704371,1.176322773,1.182692298,1.22650853,1.286881148,1.292781749,1.310340121,1.459431619,1.485426827,1.521050737,1.59454855,1.695993813,1.713695815,1.726831217,0.40053793,0.411426246,0.59454855,0.925999419,0.941106311,0.948600847,0.98550043,1.028569152,1.070389328,1.117695043,1.124328135,1.220329955,1.316145742,1.744161096);

@{$datasets{c}[0]} = (-0.043943348,-0.029146346,-0.01449957,0.028569152,0.097610797,0.124328135,0.176322773,0.201633861,0.263034406,-0.862496476,-0.104697379,0.084064265,0.084064265,0.084064265,0.124328135,0.124328135,0.163498732,0.263034406,0.275007047,0.286881148,0.321928095,0.333423734);
@{$datasets{c}[1]} = (-2.64385619,-2.556393349,-2.473931188,-2.395928676,-2.395928676,-2.395928676,-2.321928095,-2.321928095,-2.321928095,-2.251538767,-2.251538767,-2.184424571,-2.120294234,-2,-0.535331733,-1.64385619,-1.556393349,-1.514573173,-1.514573173,-1.473931188,-1.434402824,-1.434402824,-1.395928676,-1.395928676,-1.395928676,-1.395928676,-1.358453971,-1.358453971,-1.358453971,-1.358453971,-1.358453971,-1.321928095,-1.286304185,-1.286304185,-1.286304185,-1.251538767,-1.217591435,-1.120294234,-1);

@{$datasets{d}[0]} = (0.933572638261024,0.948600847493356,0.948600847493356,0.970853654340483,0.978195629681652,1.111031312388740,1.150559676575380,1.416839741912830,0.731183241572200,0.790772037862000,0.815575428862573,0.855989697308481,0.871843648509318,0.895302621333307,0.933572638261024,0.941106310946431,0.948600847493356,0.956056652412403,0.970853654340483,0.992768430768924,1.000000000000000,1.063502942306160,1.226508529808680,1.269033146455240,1.298658315564520,1.704871964456350);
@{$datasets{d}[1]} = (-0.473931188332412,0.028569152196771,0.042644337408494,0.056583528366368,0.070389327891398,0.084064264788475,0.097610796626422,0.111031312388744,0.454175893185802,0.454175893185802,-0.514573172829758,-0.268816758427800,-0.168122758808327,-0.136061549576028,-0.043943347587597,0.014355292977070,0.111031312388744,0.124328135002202,0.137503523749935,0.176322772640463,0.238786859587116,0.250961573533219,0.344828496997441);

foreach my $dataset (sort keys %datasets) {

    my $ttest = new Statistics::TTest;
    $ttest->load_data(\@{$datasets{$dataset}[0]},\@{$datasets{$dataset}[1]});
    print "$dataset - t_prob:\t$ttest->{t_prob}\n";

}

print "\n*** NEW ***\n\n";

foreach my $dataset (sort keys %datasets) {

    my $aov = Statistics::ANOVA->new();

    $aov->load( "$dataset\1", \@{$datasets{$dataset}[0]} );
    $aov->add( "$dataset\2", \@{$datasets{$dataset}[1]} );

    my $str = $aov->anova(independent => 1, parametric => 1, ordinal => 0);

    print $str->{_stat}->{p_value} . "\n";
}

print "\n*** NEW2 ***\n\n";
 # Some data:
 my @gp1 = (qw/8 7 11 14 9/);
 my @gp2 = (qw/11 9 8 11 13/);

 # Load the data (names should be stringy or numerical, depending on level of measurement):
 $aov->load_data({1 => \@gp1, 2 => \@gp2}); # NB: hashref
 # or $aov->load_data([ [1, \@gp1], [2, \@gp2] ]);
 # or $aov->load_data([ [1, @gp1], [2, @gp2] ]);

 # Now here comes another one - too late for just comparing the two:
 my @gp3 = (qw/7 13 12 8 10/);
 $aov->add_data(3 => \@gp3);
 
 # All loaded as Statistics::Descriptive objects in hash named "data", so, e.g.,
 printf("Mean for Group $_ = %.2f\n", $aov->{'data'}->{$_}->mean) foreach sort {$a cmp $b} keys %{$aov->{'data'}};

 #  Test equality of variances before omnibus comparison:
 $aov->obrien()->dump(title => 'O\'Brien\'s test of equality of variances');
 $aov->levene()->dump(title => 'Levene\'s test of equality of variances');

 # 1.10 Independent nominal groups ANOVA - parametric testing:
 $aov->anova(independent => 1, parametric => 1)->dump(title => 'Indep. groups parametric ANOVA', eta_squared => 1, omega_squared => 1);
 # 1.11 Independent nominal groups ANOVA - NON-parametric:
 $aov->anova(independent => 1, parametric => 0)->dump(title => 'Kruskal-Wallis test');