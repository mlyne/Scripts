<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
    <title>pattern-web</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link type="text/css" rel="stylesheet" href="../clips.css" />
    <style>
        /* Small fixes because we omit the online layout.css. */
        h3 { line-height: 1.3em; }
        #page { margin-left: auto; margin-right: auto; }
        #header, #header-inner { height: 175px; }
        #header { border-bottom: 1px solid #C6D4DD;  }
        table { border-collapse: collapse; }
    </style>
</head>
<body class="node-type-page one-sidebar sidebar-right section-pages">
    <div id="page">
    <div id="page-inner">
    <div id="header"><div id="header-inner"></div></div>
    <div id="content">
    <div id="content-inner">
    <div class="node node-type-page"
        <div class="node-inner">
        <div class="breadcrumb">View online at: <a href="http://www.clips.ua.ac.be/pages/pattern-web" class="noexternal" target="_blank">http://www.clips.ua.ac.be/pages/pattern-web</a></div>
        <h1>pattern.web</h1>
        <!-- Parsed from the online documentation. -->
        <div id="node-1355" class="node node-type-page"><div class="node-inner">
<div class="content">
<h3>The pattern.web module bundles robust tools for online data mining: asynchronous requests, a uniform API for various web services (Google, Bing, Yahoo, Twitter, Wikipedia, Flickr, RSS, Atom), a HTML DOM parser, HTML tag stripping functions, web crawler, webmail, caching mechanisms, Unicode support.</h3>
<p>It can be used by itself or with other <a href="pattern.html">pattern</a> modules: web | <a href="pattern-db.html">db</a>&nbsp;| <a href="pattern-en.html">en</a> | <a href="pattern-search.html">search</a> | <a href="pattern-vector.html">vector</a> | <a href="pattern-graph.html">graph</a>.</p>
<p><img src="../g/pattern_schema.gif" alt="" width="606" height="180" /></p>
<hr />
<h2>Documentation</h2>
<ul>
<li><a href="#URL">URL downloads</a></li>
<li><a href="#asynchronous">Asynchronous requests</a></li>
<li><a href="#services">Search engine + web services</a>&nbsp;<span class="smallcaps link-maintenance">(google, bing, yahoo, twitter, wikipedia, flickr)</span></li>
<li><a href="#sort">Web sort</a></li>
<li><a href="#plaintext">HTML to plaintext</a></li>
<li><a href="#DOM">HTML DOM parser</a></li>
<li><a href="#pdf">PDF parser</a></li>
<li><a href="#spider">Spider</a></li>
<li><a href="#mail">E-mail</a></li>
<li><a href="#cache">Cache</a></li>
</ul>
<p>&nbsp;</p>
<h2>
<hr /></h2>
<h2><a name="URL"></a>URL downloads</h2>
<p>The <span class="inline_code">URL</span> object is based on Python's <span class="inline_code">urllib2.Request</span> and offers a robust way of working with online content. It has a <span class="inline_code">URL.download()</span> method that retrieves the content associated with a web address as a Unicode string. The <span class="inline_code">method</span> parameter determines how <span class="inline_code">query</span> data is encoded:</p>
<ul>
<li><span class="inline_code">GET</span>: query is encoded in the URL string (typically used for retrieving data).</li>
<li><span class="inline_code">POST</span>: query is encoded in the message body (used for posting data).</li>
</ul>
<p><span class="geshifilter"><code class="python geshifilter-python">url = URL<span style="">&#40;</span><span style="">string</span>=<span style="color: #657a8a;">''</span>, method=GET, query=<span style="">&#123;</span><span style="">&#125;</span><span style="">&#41;</span></code></span><span class="geshifilter"><code class="python geshifilter-python">url.<span style="">string</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># u'http://user:pw@domain.com:30/path/page?p=1#anchor'</span><br />
url.<span style="">parts</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Dictionary of attributes:</span></code></span><span class="geshifilter"><code class="python geshifilter-python">url.<span style="">protocol</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># u'http'</span><br />
url.<span style="">username</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># u'user'</span><br />
url.<span style="">password</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># u'pw'</span><br />
url.<span style="">domain</span>  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># u'domain.com'</span><br />
url.<span style="">port</span>  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># u'30'</span><br />
url.<span style="">path</span>  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># [u'path']</span><br />
url.<span style="">page</span>  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># u'page'</span><br />
url.<span style="">query</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># {u'p': '1'}</span><br />
url.<span style="">querystring</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># u'p=1'</span><br />
url.<span style="">anchor</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># u'anchor'</span></code></span><span class="geshifilter"><code class="python geshifilter-python">url.<span style="">exists</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># False if URL.open() raises a HTTP404NotFound.</span><br />
url.<span style="">redirect</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Actual URL after redirection, or None.</span><br />
url.<span style="">headers</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Dictionary of HTTP response headers.</span><br />
url.<span style="">mimetype</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Document MIME-type.</span></code></span><span class="geshifilter"><code class="python geshifilter-python">url.<span style="color: #4a587c;">open</span><span style="">&#40;</span>timeout=<span style="color: #666;">10</span>, proxy=<span style="color: #4a587c;">None</span><span style="">&#41;</span><br />
url.<span style="">download</span><span style="">&#40;</span>timeout=<span style="color: #666;">10</span>, cached=<span style="color: #4a587c;">True</span>, throttle=<span style="color: #666;">0</span>, proxy=<span style="color: #4a587c;">None</span><span style="">&#41;</span><br />
url.<span style="">copy</span><span style="">&#40;</span><span style="">&#41;</span> </code></span></p>
<ul>
<li><span class="inline_code">URL()</span> expects a string starting with a valid protocol (e.g. <span class="inline_code">http://</span>).<span class="inline_code">&nbsp;</span></li>
<li><span class="inline_code">URL.open()</span> returns a connection from which data can be retrieved with <span class="inline_code">connection.read()</span>.</li>
<li><span class="inline_code">URL.download()</span> will cache the retrieved data locally by default (faster next time). <br />Raises a <span class="inline_code">URLTimeoutError</span> if the download takes longer than the given <span class="inline_code">timeout</span>.<br />Sleeps for <span class="inline_code">throttle</span> seconds after the download is complete.<br />A proxy server can be given as a <span class="inline_code">(host, protocol)</span>-tuple.</li>
</ul>
<p>The following example downloads an image. <br />The helper function <span class="inline_code">extension()</span> parses the file extension from a file name:</p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">from</span> pattern.<span style="">web</span> <span style="color: #28334f; font-weight: bold;">import</span> URL, extension<br />
<span style="">&gt;&gt;&gt;</span> url = URL<span style="">&#40;</span><span style="color: #657a8a;">'http://www.clips.ua.ac.be/media/pattern_schema.gif'</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> f = <span style="color: #4a587c;">open</span><span style="">&#40;</span><span style="color: #657a8a;">'test'</span> + extension<span style="">&#40;</span>url.<span style="">page</span><span style="">&#41;</span>, <span style="color: #657a8a;">'w'</span><span style="">&#41;</span> <span style="color: grey;"># save as test.gif</span><br />
<span style="">&gt;&gt;&gt;</span> f.<span style="">write</span><span style="">&#40;</span>url.<span style="">download</span><span style="">&#40;</span><span style="">&#41;</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> f.<span style="">close</span><span style="">&#40;</span><span style="">&#41;</span></code></span></span></p>
<h3>URL exceptions</h3>
<p><span class="inline_code">URL.open()</span> and <span class="inline_code">URL.download()</span> raise a <span class="inline_code">URLError</span> if something goes wrong. This is quite common since a lot of things can fail – no internet connection, server is down, etc.&nbsp; <span class="inline_code">URLError</span> has a number of subclasses that can help you figure out the error:</p>
<table class="border">
<tbody>
<tr>
<td><span class="smallcaps">Exception</span></td>
<td><span class="smallcaps">Description</span></td>
</tr>
<tr>
<td><span class="inline_code">URLError</span></td>
<td>URL contains errors (e.g. a missing <span class="inline_code">t</span> in <span class="inline_code">htp://</span>)</td>
</tr>
<tr>
<td><span class="inline_code">URLTimeout</span></td>
<td>URL takes too long to load.</td>
</tr>
<tr>
<td><span class="inline_code">HTTPError</span></td>
<td>URL causes an error on the contacted server.</td>
</tr>
<tr>
<td><span class="inline_code">HTTP400BadRequest</span></td>
<td>URL contains an invalid request.</td>
</tr>
<tr>
<td><span class="inline_code">HTTP401Authentication</span></td>
<td>URL requires a login and password.</td>
</tr>
<tr>
<td><span class="inline_code">HTTP403Forbidden</span></td>
<td>URL is not accessible (check user-agent).</td>
</tr>
<tr>
<td><span class="inline_code">HTTP404NotFound</span></td>
<td>URL doesn't exist on the internet.</td>
</tr>
</tbody>
</table>
<h3>URL mime-type</h3>
<p><span class="inline_code">URL.mimetype</span> can be used to check the type of content at the given address, which is more reliable than simply looking at the filename extension (which may be missing).</p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> url = URL<span style="">&#40;</span><span style="color: #657a8a;">'http://www.clips.ua.ac.be/media/pattern_schema.gif'</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">print</span> url.<span style="">mimetype</span> <span style="color: #28334f; font-weight: bold;">in</span> MIMETYPE_IMAGE<br />
<br />
<span style="color: #4a587c;">True</span></code></span></span></p>
<table class="border">
<tbody>
<tr>
<td><span class="smallcaps">Global</span></td>
<td><span class="smallcaps">Value</span></td>
</tr>
<tr>
<td><span class="inline_code">MIMETYPE_WEBPAGE</span></td>
<td><span class="inline_code">['text/html']</span></td>
</tr>
<tr>
<td><span class="inline_code">MIMETYPE_STYLESHEET</span></td>
<td><span class="inline_code">['text/css']</span></td>
</tr>
<tr>
<td><span class="inline_code">MIMETYPE_PLAINTEXT</span></td>
<td><span class="inline_code">['text/plain']</span></td>
</tr>
<tr>
<td><span class="inline_code">MIMETYPE_PDF</span></td>
<td><span class="inline_code">['application/pdf']</span></td>
</tr>
<tr>
<td><span class="inline_code">MIMETYPE_NEWSFEED</span></td>
<td><span class="inline_code">['application/rss+xml', 'application/atom+xml']</span></td>
</tr>
<tr>
<td><span class="inline_code">MIMETYPE_IMAGE</span></td>
<td><span class="inline_code">['image/gif', 'image/jpeg', 'image/x-png']</span></td>
</tr>
<tr>
<td><span class="inline_code">MIMETYPE_AUDIO</span></td>
<td><span class="inline_code">['audio/mpeg', 'audio/x-aiff', 'audio/x-wav']</span></td>
</tr>
<tr>
<td><span class="inline_code">MIMETYPE_VIDEO</span></td>
<td><span class="inline_code">['video/mpeg', 'video/quicktime']</span></td>
</tr>
<tr>
<td><span class="inline_code">MIMETYPE_ARCHIVE</span></td>
<td><span class="inline_code">['application/x-tar', 'application/zip']</span></td>
</tr>
</tbody>
</table>
<h3>User-agent and referrer</h3>
<p><span class="inline_code">URL.open()</span> and <span class="inline_code">URL.download()</span> have two optional parameters: <span class="inline_code">user_agent</span> and <span class="inline_code">referrer</span>, used to identify the application accessing the web. Some websites include code to block out any application except browsers. By setting a <span class="inline_code">user_agent</span> you can make the application appear as a browser. This is called <em>spoofing</em> and it is not encouraged, though sometimes necessary.</p>
<p>For example, to pose as a Firefox browser:</p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> URL<span style="">&#40;</span><span style="color: #657a8a;">'http://www.clips.ua.ac.be'</span><span style="">&#41;</span>.<span style="">download</span><span style="">&#40;</span>user_agent=<span style="color: #657a8a;">'Mozilla/5.0'</span><span style="">&#41;</span></code></span></span></p>
<h3>Find URLs</h3>
<p>The <span class="inline_code">find_urls()</span> command can be used to parse URLs from a text string. This will work on links starting with <span class="inline_code">http://</span>, <span class="inline_code">https://</span>, <span class="inline_code">www.</span> or domain names ending in <span class="inline_code">.com</span>, <span class="inline_code">.org</span>. <span class="inline_code">.net</span>. The parser will detect and strip leading punctuation (open parens) and trailing punctuation (period, comma, close parens). Comparably, the <span class="inline_code">find_email()</span> command can be used to parse e-mail addresses from a string.</p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">print</span> find_urls<span style="">&#40;</span><span style="color: #657a8a;">'Visit our website (www․clips.ua.ac.be)'</span>, unique=<span style="color: #4a587c;">True</span><span style="">&#41;</span><br />
<br />
<span style="">&#91;</span><span style="color: #657a8a;">'www.clips.ua.ac.be'</span><span style="">&#93;</span></code></span></span></p>
<p>&nbsp;</p>
<h2>
<hr /></h2>
<h2><a name="asynchronous"></a>Asynchronous requests</h2>
<p>The <span class="inline_code">asynchronous()</span> command can be used to execute a function in the background. It takes  the function, its arguments and optional keyword arguments. It returns  an <span class="inline_code">AsynchronousRequest</span> object that stores the given function's return value – once it is done. The main program can continue to run in the meantime.</p>
<p><span style="font-family: Courier,monospace; font-size: small;"><span style="font-size: 12px;"><span class="geshifilter"><code class="python geshifilter-python">request = asynchronous<span style="">&#40;</span>function, <span style="">*</span>args, <span style="">**</span>kwargs<span style="">&#41;</span></code></span><span class="geshifilter"><code class="python geshifilter-python">request.<span style="">done</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># True when the function is done.</span><br />
request.<span style="">elapsed</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Time running, in seconds.</span><br />
request.<span style="">value</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Function return value when done (or None).</span><br />
request.<span style="">error</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Function Exception (if any).</span></code></span></span></span></p>
<p><span style="font-family: Courier,monospace; font-size: small;"><span style="font-size: 12px;"><span class="geshifilter"><code class="python geshifilter-python">request.<span style="">now</span><span style="">&#40;</span><span style="">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Waits for function and returns its value.</span></code></span></span></span></p>
<p>This  is useful to execute a web query without hanging the user interface of  your application, but instead display a progress bar (for example). The  example below illustrates this. In a real-world setup you would poll <span class="inline_code">request.done</span> in the application's event loop:</p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">import</span> <span style="">time</span><br />
<span style="">&gt;&gt;&gt;</span> request = asynchronous<span style="">&#40;</span>Google<span style="">&#40;</span><span style="">&#41;</span>.<span style="">search</span>, <span style="color: #657a8a;">'holy grail'</span>, timeout=<span style="color: #666;">4</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">while</span> <span style="color: #28334f; font-weight: bold;">not</span> request.<span style="">done</span>:<br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp;<span style="">time</span>.<span style="">sleep</span><span style="">&#40;</span><span style="color: #666;">0.1</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp;<span style="color: #28334f; font-weight: bold;">print</span> <span style="color: #657a8a;">'busy...'</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">print</span> request.<span style="">value</span></code></span></span></p>
<p>For  a number of good reasons, there is no way to interrupt or "kill" a  background process (i.e. a Python thread). You are responsible for  ensuring that the given function doesn't hang.</p>
<p>&nbsp;</p>
<hr />
<h2><a name="services"></a>Search engine + web services</h2>
<p>The <span class="inline_code">SearchEngine</span> object offers a uniform way to address different web services, such as Google and Wikipedia. The <span class="inline_code">SearchEngine.search()</span> method returns a list of <span class="inline_code">Result</span> objects for a given query string – similar to a search field in a browser.</p>
<p><span class="geshifilter"><code class="python geshifilter-python">engine = SearchEngine<span style="">&#40;</span>license=<span style="color: #4a587c;">None</span>, throttle=<span style="color: #666;">1.0</span>, language=<span style="color: #4a587c;">None</span><span style="">&#41;</span></code></span></p>
<p><span class="geshifilter"><code class="python geshifilter-python">engine.<span style="">license</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Service license key.</span><br />
engine.<span style="">throttle</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Time between requests (being nice to server).</span><br />
engine.<span style="">language</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Restriction for Result.language (e.g., 'en').</span></code></span></p>
<p><span class="geshifilter"><code class="python geshifilter-python">engine.<span style="">search</span><span style="">&#40;</span>query, <br />
&nbsp; &nbsp; type = SEARCH, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># SEARCH | IMAGE | NEWS | BLOG | TRENDS</span><br />
&nbsp; &nbsp;start = <span style="color: #666;">1</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Starting page.</span><br />
&nbsp; &nbsp;count = <span style="color: #666;">10</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Results per page.</span><br />
&nbsp; &nbsp; sort = RELEVANCY, &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Results sort order: RELEVANCY | LATEST</span><br />
&nbsp; &nbsp; size = <span style="color: #4a587c;">None</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Image size: TINY | SMALL | MEDIUM | LARGE</span><br />
&nbsp; cached = <span style="color: #4a587c;">True</span><span style="">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Cache locally?</span></code></span></p>
<p><span class="small"><span style="text-decoration: underline;">Note</span>: <span class="inline_code">SearchEngine.search()</span> also takes the same optional parameters as <span class="inline_code">URL.download()</span>.</span></p>
<h3>Google | Yahoo | Bing | Twitter | Wikipedia | Flickr</h3>
<p><span class="inline_code">SearchEngine</span> is subclassed by <span class="inline_code">Google</span>, <span class="inline_code">Yahoo</span>, <span class="inline_code">Bing</span>, <span class="inline_code">Twitter</span>, <span class="inline_code">Wikipedia</span>, <span class="inline_code">Flickr</span>, <span class="inline_code">Newsfeed</span>:</p>
<p><span class="geshifilter"><code class="python geshifilter-python">engine = Google<span style="">&#40;</span>license=<span style="color: #4a587c;">None</span>, throttle=<span style="color: #666;">1.0</span>, language=<span style="color: #4a587c;">None</span><span style="">&#41;</span></code></span></p>
<p><span class="geshifilter"><code class="python geshifilter-python">engine = Yahoo<span style="">&#40;</span>license=<span style="color: #4a587c;">None</span>, throttle=<span style="color: #666;">1.0</span><span style="">&#41;</span></code></span></p>
<p><span class="geshifilter"><code class="python geshifilter-python">engine = Bing<span style="">&#40;</span>license=<span style="color: #4a587c;">None</span>, throttle=<span style="color: #666;">1.0</span>, language=<span style="color: #4a587c;">None</span><span style="">&#41;</span></code></span></p>
<p><span class="geshifilter"><code class="python geshifilter-python">engine = Twitter<span style="">&#40;</span>license=<span style="color: #4a587c;">None</span>, throttle=<span style="color: #666;">0.5</span>, language=<span style="color: #4a587c;">None</span><span style="">&#41;</span></code></span></p>
<p><span class="geshifilter"><code class="python geshifilter-python">engine = Wikipedia<span style="">&#40;</span>license=<span style="color: #4a587c;">None</span>, throttle=<span style="color: #666;">5.0</span>, language=<span style="color: #657a8a;">&quot;en&quot;</span><span style="">&#41;</span></code></span></p>
<p><span class="geshifilter"><code class="python geshifilter-python">engine = Flickr<span style="">&#40;</span>license=<span style="color: #4a587c;">None</span>, throttle=<span style="color: #666;">5.0</span><span style="">&#41;</span></code></span></p>
<p><span class="geshifilter"><code class="python geshifilter-python">engine = Newsfeed<span style="">&#40;</span>license=<span style="color: #4a587c;">None</span>, throttle=<span style="color: #666;">1.0</span><span style="">&#41;</span></code></span></p>
<p>Each of these has different settings for <span class="inline_code">search()</span>. For example,&nbsp;<span class="inline_code">Twitter.search()</span> returns up to a 1500 results for a search term (15 queries with 100 results each, or 150 queries with 10 results each). It has an hourly limit of 150 queries (each call to <span class="inline_code">search()</span> counts as one query).</p>
<table class="border">
<tbody>
<tr>
<td><span class="smallcaps">Engine</span></td>
<td><span class="smallcaps">type</span></td>
<td><span class="smallcaps">start</span></td>
<td><span class="smallcaps">count</span></td>
<td><span class="smallcaps">sort</span></td>
<td><span class="smallcaps">limit</span></td>
<td><span class="smallcaps">throttle</span></td>
</tr>
<tr>
<td><span class="inline_code">Google</span></td>
<td><span class="inline_code">SEARCH<sup>1</sup></span></td>
<td>1-100/<span class="inline_code">count</span></td>
<td>1-10</td>
<td><span class="inline_code">RELEVANCY</span></td>
<td><span class="smallcaps">paid</span></td>
<td>0.5</td>
</tr>
<tr>
<td><span class="inline_code">Yahoo</span></td>
<td><span class="inline_code">SEARCH|IMAGE|NEWS<sup>12</sup></span></td>
<td>1-1000/count</td>
<td>1-50</td>
<td><span class="inline_code">RELEVANCY</span></td>
<td><span class="smallcaps">paid</span></td>
<td>0.5</td>
</tr>
<tr>
<td><span class="inline_code">Bing</span></td>
<td><span class="inline_code">SEARCH|IMAGE|NEWS<sup>3</sup></span></td>
<td>1-1000/<span class="inline_code">count</span></td>
<td>1-50</td>
<td><span class="inline_code">RELEVANCY</span></td>
<td>-</td>
<td>1.0</td>
</tr>
<tr>
<td><span class="inline_code">Twitter</span></td>
<td><span class="inline_code">SEARCH|TRENDS<sup>4</sup></span></td>
<td>1-1500/<span class="inline_code">count</span></td>
<td>1-100</td>
<td><span class="inline_code">RELEVANCY</span></td>
<td>150/hour</td>
<td>0.5</td>
</tr>
<tr>
<td><span style="font-family: Courier,monospace; font-size: small;"><span style="font-size: 12px;">Wikipedia</span></span></td>
<td><span style="font-family: Courier,monospace; font-size: small;"><span style="font-size: 12px;">SEARCH</span></span></td>
<td>1</td>
<td>1</td>
<td><span style="font-family: Courier,monospace; font-size: small;"><span style="font-size: 12px;">RELEVANCY</span></span></td>
<td>-</td>
<td>5.0</td>
</tr>
<tr>
<td><span style="font-family: Courier,monospace; font-size: small;"><span style="font-size: 12px;">Flickr<br /></span></span></td>
<td><span style="font-family: Courier,monospace; font-size: 12px;">IMAGE</span></td>
<td>1+</td>
<td>1-500</td>
<td><span style="font-family: Courier,monospace; font-size: 12px;">RELEVANCY|LATEST</span></td>
<td>-</td>
<td>5.0</td>
</tr>
<tr>
<td><span class="inline_code">Newsfeed</span></td>
<td><span class="inline_code">NEWS</span>&nbsp;</td>
<td>1+&nbsp;</td>
<td>-&nbsp;</td>
<td><span class="inline_code">LATEST</span>&nbsp;</td>
<td>?&nbsp;</td>
<td>1.0&nbsp;</td>
</tr>
</tbody>
</table>
<p><span class="small"><sup>1&nbsp;</sup><span class="inline_code">Google</span> and <span class="inline_code">Yahoo</span> are paid services – see further how to obtain a license key.<span style="color: #666666; font-size: x-small;"><span style="font-size: 10px;"><br /></span></span></span><span style="font-size: 11px;"><sup style="color: #666666;">2&nbsp;</sup><span style="font-family: Courier,monospace; font-size: 12px;">Yahoo.search(type=IMAGES)</span></span><span style="font-size: 11px;">&nbsp;has a&nbsp;<span class="inline_code" style="font-family: Courier, monospace; font-size: 12px;">count</span>&nbsp;of 1-35.<br /></span><span style="font-size: 11px;"><sup style="color: #666666;">3&nbsp;</sup><span style="font-family: Courier,monospace; font-size: 12px;">Bing.search(type=NEWS)</span></span><span style="font-size: 11px;">&nbsp;has a&nbsp;<span class="inline_code" style="font-family: Courier, monospace; font-size: 12px;">count</span>&nbsp;of 1-15.</span><br /><span class="small"><sup>4&nbsp;</sup><span style="font-family: Courier,monospace; font-size: 12px;">Twitter.search(type=TRENDS)</span>&nbsp;yields a maximum 0f 10 results.</span></p>
<h3>Results</h3>
<p><span class="inline_code">SearchEngine.search()</span> returns a list of <span class="inline_code">Result</span> objects. The list has an additional <span class="inline_code">total</span> attribute, an estimate of the total number of results available for the given query. Each <span class="inline_code">Result</span> holds useful information:</p>
<p><span class="geshifilter"><code class="python geshifilter-python">result = Result<span style="">&#40;</span>url<span style="">&#41;</span></code></span></p>
<p><span class="geshifilter"><code class="python geshifilter-python">result.<span style="">url</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># URL of content associated with the given query.</span><br />
result.<span style="">title</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Content title.</span><br />
result.<span style="">description</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Content summary.</span><br />
result.<span style="">language</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Content language.</span><br />
result.<span style="">author</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># For news items and images.</span><br />
result.<span style="">date</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># For news items.</span></code></span><span class="geshifilter"><code class="python geshifilter-python">result.<span style="">download</span><span style="">&#40;</span>timeout=<span style="color: #666;">10</span>, cached=<span style="color: #4a587c;">True</span>, proxy=<span style="color: #4a587c;">None</span><span style="">&#41;</span></code></span></p>
<ul>
<li>All attributes are Unicode strings.</li>
<li>The <span class="inline_code">Result.download()</span> method uses the <span class="inline_code">URL</span> object internally.<br />It takes the same optional parameters as <span class="inline_code">URL.download()</span>.</li>
</ul>
<p>For example:</p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> engine = Bing<span style="">&#40;</span>license=<span style="color: #4a587c;">None</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">for</span> i <span style="color: #28334f; font-weight: bold;">in</span> <span style="color: #4a587c;">range</span><span style="">&#40;</span><span style="color: #666;">1</span>,<span style="color: #666;">5</span><span style="">&#41;</span>:<br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp;<span style="color: #28334f; font-weight: bold;">for</span> result <span style="color: #28334f; font-weight: bold;">in</span> engine.<span style="">search</span><span style="">&#40;</span><span style="color: #657a8a;">'holy handgrenade'</span>, type=SEARCH, start=i<span style="">&#41;</span>:<br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #28334f; font-weight: bold;">print</span> <span style="color: #4a587c;">repr</span><span style="">&#40;</span>plaintext<span style="">&#40;</span>result.<span style="">description</span><span style="">&#41;</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #28334f; font-weight: bold;">print</span><br />
<br />
u<span style="color: #657a8a;">&quot;The Holy Hand Grenade of Antioch is a fictional weapon from the movie Monty Python and the Holy Grail. It bears a striking resemblance to the Sovereign's ...&quot;</span><br />
<br />
u<span style="color: #657a8a;">'Once the number three, being the third number, be reached, then lobbest thou thy Holy Hand Grenade of Antioch towards thy foe, who, being naughty in my ...'</span><br />
</code></span></span></p>
<p>&nbsp;</p>
<p><span class="smallcaps">Image search<br /></span></p>
<p>For <span class="inline_code">Yahoo</span>, <span class="inline_code">Bing</span> and <span class="inline_code">Flickr</span>, image links retrieved with <span class="inline_code">search(type=IMAGE)</span> can be filtered by setting the <span class="inline_code">size</span> parameter to <span style="font-family: Courier, monospace; font-size: 12px;">TINY<span style="font-family: Georgia, Times, serif; font-size: 13px;">&nbsp;|&nbsp;</span>SMALL<span style="font-family: Georgia, Times, serif; font-size: 13px;">&nbsp;|&nbsp;</span>MEDIUM<span style="font-family: Georgia, Times, serif; font-size: 13px;">&nbsp;|&nbsp;</span>LARGE</span> (or&nbsp;<span style="font-family: Courier, monospace; font-size: 12px;">None</span>&nbsp;for any size).&nbsp;Note that <span class="inline_code">Yahoo</span> image search has a <span class="inline_code">count</span> of 1-35.</p>
<p>The use of downloaded images may be restricted by authorship.&nbsp;<span class="inline_code">Flickr.search()</span> can be used with an optional <span class="inline_code">copyright=False</span>. This will only retrieve results with no copyright restrictions (either under Creative Commons license <a href="http://creativecommons.org/licenses/by-sa/2.0/" target="_blank">by-sa</a>&nbsp;or in the public domain).</p>
<p>&nbsp;</p>
<p><span class="smallcaps">Service license key</span></p>
<p>Some services require a license key. They may work without one, but this implies that you share a public license key (and query limit) with all other users of the web module. If you reach the query limit, <span class="inline_code">SearchEngine.search()</span> will raise an <span class="inline_code">SearchEngineLimitError</span>.</p>
<p><span class="inline_code">Google</span> is a paid service (5$ per 1o00 queries). If you have a license key you get 100 free queries per day. To get a key, follow the link below, activate "Custom Search API" under "Services" and look up your key under "API Access".</p>
<p><span class="inline_code">Yahoo</span>&nbsp;is a paid service (0.8$ per 1000 queries) that requires an OAuth key + secret, which you can pass as a tuple to <span class="inline_code">Yahoo(license=(key, secret))</span>.</p>
<p>Obtain a license key for: <a href="https://code.google.com/apis/console/" target="_blank">Google</a>,&nbsp;<a href="http://www.bing.com/developers/createapp.aspx" target="_blank">Bing</a>, <a href="http://developer.yahoo.com/search/boss/" target="_blank">Yahoo</a>, <a href="http://www.flickr.com/services/api/keys/" target="_blank">Flickr</a>.</p>
<p>&nbsp;</p>
<p><span class="smallcaps">Service request throttle</span></p>
<p>A <span class="inline_code">SearchEngine.search()</span> request takes a minimum amount of time to complete, as outlined in the table above. This is intended as etiquette towards the servers providing the service. Be polite and raise the throttle value when you plan to run a lot of queries in batch.</p>
<p>Note that Wikipedia requests are especially intensive. If you plan to mine a lot of data from Wikipedia, download the <a href="http://en.wikipedia.org/wiki/Wikipedia:Database_download">Wikipedia database</a> instead.</p>
<p>&nbsp;</p>
<hr />
<h2>RSS + Atom newsfeeds</h2>
<p>The <span class="inline_code">Newsfeed</span> object is a wrapper around Mark Pilgrim's <a href="http://www.feedparser.org/" target="_blank">Universal Feed Parser</a>. <span class="inline_code">Newsfeed.search()</span> takes the web address of an RSS or Atom news feed and returns a list of <span class="inline_code">Result</span> objects. For example:</p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> NATURE = <span style="color: #657a8a;">'http://www.nature.com/nature/current_issue/rss/index.html'</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">for</span> result <span style="color: #28334f; font-weight: bold;">in</span> Newsfeed<span style="">&#40;</span><span style="">&#41;</span>.<span style="">search</span><span style="">&#40;</span>NATURE<span style="">&#41;</span><span style="">&#91;</span>:<span style="color: #666;">5</span><span style="">&#93;</span>:<br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp;<span style="color: #28334f; font-weight: bold;">print</span> <span style="color: #4a587c;">repr</span><span style="">&#40;</span>result.<span style="">title</span><span style="">&#41;</span><br />
<br />
u<span style="color: #657a8a;">'Biopiracy rules should not block biological control'</span><br />
u<span style="color: #657a8a;">'Animal behaviour: Same-shaped shoals'</span><br />
u<span style="color: #657a8a;">'Genetics: Fast disease factor'</span><br />
u<span style="color: #657a8a;">'Biomimetics: Material monitors mugginess'</span><br />
u<span style="color: #657a8a;">'Cell biology: Lung lipid hurts breathing'</span></code></span></span></p>
<p>&nbsp;</p>
<hr />
<h2>Google translate</h2>
<p>The <span class="inline_code">Google.translate()</span> method returns the translation of a string in the given language.<br />The <span class="inline_code">Google.identify()</span> method returns a (<span class="inline_code">language code</span>, <span class="inline_code">reliability</span>)-tuple for a given string.&nbsp;</p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> s = <span style="color: #657a8a;">&quot;C'est un lapin, lapin de bois. Quoi? Un cadeau.&quot;</span><br />
<span style="">&gt;&gt;&gt;</span> g = Google<span style="">&#40;</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">print</span> g.<span style="">translate</span><span style="">&#40;</span>s, <span style="color: #4a587c;">input</span>=<span style="color: #657a8a;">'fr'</span>, output=<span style="color: #657a8a;">'en'</span>, cached=<span style="color: #4a587c;">False</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">print</span> g.<span style="">identify</span><span style="">&#40;</span>s<span style="">&#41;</span><br />
<br />
u<span style="color: #657a8a;">&quot;It's a bunny, rabbit wood. What? A gift.&quot;</span><br />
<span style="">&#40;</span>u<span style="color: #657a8a;">'fr'</span>, <span style="color: #666;">0.76</span><span style="">&#41;</span> </code></span></span></p>
<p>&nbsp;</p>
<h2>
<hr />Wikipedia articles</h2>
<p><span class="inline_code">Wikipedia.search()</span> does not return a list of <span class="inline_code">Result</span> objects. Instead, it returns a single <span class="inline_code">WikipediaArticle</span> for the given (case-sensitive) query. The <span class="inline_code">Wikipedia</span> constructor has an additional <span class="inline_code">language</span> parameter (by default, <span class="inline_code">"en"</span>) that determines the language of the returned articles.</p>
<p><span class="geshifilter"><code class="python geshifilter-python">article = WikipediaArticle<span style="">&#40;</span>title=u<span style="color: #657a8a;">''</span>, source=u<span style="color: #657a8a;">''</span>, links=<span style="">&#91;</span><span style="">&#93;</span><span style="">&#41;</span></code></span><span class="geshifilter"><code class="python geshifilter-python">article.<span style="">source</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Article HTML source.</span><br />
article.<span style="">string</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Article plaintext unicode string.</span></code></span><span class="geshifilter"><code class="python geshifilter-python">article.<span style="">title</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Article title.</span><br />
article.<span style="">sections</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Article sections.</span><br />
article.<span style="">links</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># List of titles of linked articles.</span><br />
article.<span style="">external</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># List of external links.</span><br />
article.<span style="">categories</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># List of categories.</span><br />
article.<span style="">media</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># List of linked media (images, sounds, ...)</span><br />
article.<span style="">languages</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Dictionary of (language, article)-items.</span><br />
article.<span style="">language</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Article language (i.e. 'en').</span><br />
article.<span style="">disambiguation</span> &nbsp; &nbsp; &nbsp;<span style="color: grey;"># True if it is a disambiguation page</span></code></span><span class="geshifilter"><code class="python geshifilter-python">article.<span style="">plaintext</span><span style="">&#40;</span><span style="">**</span>kwargs<span style="">&#41;</span> <span style="color: grey;"># See plaintext() for parameter overview.</span><br />
article.<span style="">download</span><span style="">&#40;</span>media, <span style="">**</span>kwargs<span style="">&#41;</span></code></span></p>
<p><span class="inline_code">WikipediaArticle.plaintext()</span> is similar to the <span class="inline_code">plaintext()</span> command, but with extra attention for Wikipedia markup. It will remove metadata, infobox, table of contents, annotations, thumbnails and disambiguation links.</p>
<h3>Wikipedia article sections</h3>
<p><span class="inline_code">WikipediaArticle.sections</span> is a list of <span class="inline_code">WikipediaSection</span> objects. <br />A section has a title and a number of paragraphs that belong together.</p>
<p><span class="geshifilter"><code class="python geshifilter-python">section = WikipediaSection<span style="">&#40;</span>article, title=u<span style="color: #657a8a;">''</span>, start=<span style="color: #666;">0</span>, stop=<span style="color: #666;">0</span>, level=<span style="color: #666;">1</span><span style="">&#41;</span></code></span><span class="geshifilter"><code class="python geshifilter-python">section.<span style="">article</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># WikipediaArticle parent.</span><br />
section.<span style="">parent</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># WikipediaSection this section is part of.</span><br />
section.<span style="">children</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># WikipediaSections belonging to this section.</span></code></span><span class="geshifilter"><code class="python geshifilter-python">section.<span style="">title</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Section title.</span><br />
section.<span style="">source</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Section HTML source.</span><br />
section.<span style="">string</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Section plaintext unicode string.</span><br />
section.<span style="">content</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Section string minus title.</span><br />
section.<span style="">level</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Section nested depth.</span></code></span></p>
<p>The following example downloads a Wikipedia article and prints the title of each section, indented according to the section level:</p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> article = Wikipedia<span style="">&#40;</span><span style="">&#41;</span>.<span style="">search</span><span style="">&#40;</span><span style="color: #657a8a;">'nodebox'</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">for</span> section <span style="color: #28334f; font-weight: bold;">in</span> article.<span style="">sections</span>:<br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp;<span style="color: #28334f; font-weight: bold;">print</span> <span style="color: #4a587c;">repr</span><span style="">&#40;</span><span style="color: #657a8a;">' &nbsp;'</span><span style="">*</span><span style="">&#40;</span>section.<span style="">level</span>-<span style="color: #666;">1</span><span style="">&#41;</span> + section.<span style="">title</span><span style="">&#41;</span><br />
<br />
u<span style="color: #657a8a;">'NodeBox'</span><br />
u<span style="color: #657a8a;">' &nbsp;Features'</span><br />
u<span style="color: #657a8a;">' &nbsp;Supported Primitives'</span><br />
u<span style="color: #657a8a;">' &nbsp;Output'</span><br />
u<span style="color: #657a8a;">'Libraries'</span><br />
u<span style="color: #657a8a;">'NodeBox 2'</span><br />
u<span style="color: #657a8a;">'NodeBox for OpenGL'</span><br />
u<span style="color: #657a8a;">'Applications'</span><br />
u<span style="color: #657a8a;">'See also'</span></code></span></span></p>
<p>&nbsp;</p>
<hr />
<h2><a name="sort"></a>Web sort</h2>
<p>Interestingly, each list of results returned from <span class="inline_code">SearchEngine.search()</span> has a <span class="inline_code">total</span> property by which we can compare lists. The <span class="inline_code">sort()</span> command sorts the given terms according to search result count.</p>
<p><span class="geshifilter"><code class="python geshifilter-python">sort<span style="">&#40;</span><br />
&nbsp; &nbsp; terms = <span style="">&#91;</span><span style="">&#93;</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># List of search terms.</span><br />
&nbsp; context = <span style="color: #657a8a;">''</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Term used for sorting.</span><br />
&nbsp; service = GOOGLE, &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># GOOGLE | BING | YAHOO | FLICKR</span><br />
&nbsp; license = <span style="color: #4a587c;">None</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Service license key.</span><br />
&nbsp; &nbsp;strict = <span style="color: #4a587c;">True</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Wrap query in quotes?</span><br />
&nbsp; reverse = <span style="color: #4a587c;">False</span>,<br />
&nbsp; &nbsp;cached = <span style="color: #4a587c;">True</span><span style="">&#41;</span></code></span></p>
<p>It returns a list of <span class="inline_code">(percentage, term)</span>-tuples for the given list of terms. When a <span class="inline_code">context</span> is defined, sorts according to relevancy to the context: <span class="inline_code">sort(["black", "white"], context="Darth Vader")</span> yields <em>black</em> as the best candidate, because <span class="inline_code">"black Darth Vader"</span> is more common in search results.</p>
<p>Now let's see who is more dangerous:</p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> results = sort<span style="">&#40;</span>terms=<span style="">&#91;</span><br />
<span style="">&gt;&gt;&gt;</span> &nbsp; <span style="color: #657a8a;">'arnold schwarzenegger'</span>, <br />
<span style="">&gt;&gt;&gt;</span> &nbsp; <span style="color: #657a8a;">'chuck norris'</span>, <br />
<span style="">&gt;&gt;&gt;</span> &nbsp; <span style="color: #657a8a;">'dolph lundgren'</span>, <br />
<span style="">&gt;&gt;&gt;</span> &nbsp; <span style="color: #657a8a;">'steven seagal'</span>,<br />
<span style="">&gt;&gt;&gt;</span> &nbsp; <span style="color: #657a8a;">'sylvester stallone'</span>, <br />
<span style="">&gt;&gt;&gt;</span> &nbsp; <span style="color: #657a8a;">'mickey mouse'</span><span style="">&#93;</span>, context=<span style="color: #657a8a;">'dangerous'</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">for</span> weight, term <span style="color: #28334f; font-weight: bold;">in</span> results:<br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; <span style="color: #28334f; font-weight: bold;">print</span> <span style="color: #657a8a;">&quot;%5.2f&quot;</span> <span style="">%</span> <span style="">&#40;</span>weight<span style="">*</span><span style="color: #666;">100</span><span style="">&#41;</span> + <span style="color: #657a8a;">'%'</span>, term<br />
<br />
<span style="color: #666;">43.75</span><span style="">%</span> <span style="color: #657a8a;">'dangerous chuck norris'</span><br />
<span style="color: #666;">25.00</span><span style="">%</span> <span style="color: #657a8a;">'dangerous arnold schwarzenegger'</span><br />
<span style="color: #666;">12.50</span><span style="">%</span> <span style="color: #657a8a;">'dangerous steven seagal'</span><br />
<span style="color: #666;">12.50</span><span style="">%</span> <span style="color: #657a8a;">'dangerous mickey mouse'</span><br />
&nbsp;<span style="color: #666;">6.25</span><span style="">%</span> <span style="color: #657a8a;">'dangerous sylvester stallone'</span><br />
&nbsp;<span style="color: #666;">0.00</span><span style="">%</span> <span style="color: #657a8a;">'dangerous dolph lundgren'</span></code></span></span></p>
<p>&nbsp;</p>
<hr />
<h2><a name="plaintext"></a>HTML to plaintext</h2>
<p>Typically, <span class="inline_code">URL.download()</span> is used to retrieve HTML documents. HTML is a markup language that uses <em>tags</em> to define the text formatting. For example: <span class="inline_code">&lt;b&gt;hello&lt;/b&gt;</span> displays <strong>hello</strong> in bold. Usually, we just want the text without the formatting so we can analyze (e.g. <a href="pattern-en.html#parser">parse</a>) it.</p>
<p>The <span class="inline_code">plaintext()</span> command removes HTML formatting from a string.</p>
<p><span class="geshifilter"><code class="python geshifilter-python">plaintext<span style="">&#40;</span>html, keep=<span style="">&#91;</span><span style="">&#93;</span>, replace=blocks, linebreaks=<span style="color: #666;">2</span>, indentation=<span style="color: #4a587c;">False</span><span style="">&#41;</span></code></span></p>
<p>It will perform the following steps to clean up the given string:</p>
<ul>
<li><strong>Strip javascript:</strong> remove all <span class="inline_code">&lt;script&gt;</span> elements.</li>
<li><strong>Strip CSS: </strong>remove all <span class="inline_code">&lt;style&gt;</span> elements.</li>
<li><strong>Strip comments:</strong> remove all <span class="inline_code">&lt;!-- --&gt;</span> elements.</li>
<li><strong>Strip forms: </strong>remove all <span class="inline_code">&lt;form&gt;</span> elements.</li>
<li><strong>Strip tags: </strong>remove all HTML tags.</li>
<li><strong>Decode entities:</strong> replace <span class="inline_code">&amp;lt;</span> with <span class="inline_code">&lt;</span> (for example).</li>
<li><strong>Collapse spaces:</strong> consecutive spaces are replaced with a single space.</li>
<li><strong>Collapse linebreaks:</strong> consecutive linebreaks are replace with a single linebreak.</li>
<li><strong>Collapse tabs:</strong> consecutive tabs are replaced by a single space, optionally indentation (tabs at the start of a line) can be preserved.</li>
</ul>
<p><span class="smallcaps">plaintext tweaks</span></p>
<p>The <span class="inline_code">keep</span> parameter is a list of tags to keep. By default, element attributes are stripped, e.g. <span class="inline_code">&lt;table border="0"&gt;</span>&nbsp; becomes&nbsp; <span class="inline_code">&lt;table&gt;</span>. To preserve specific attributes, instead of a list a dictionary can be passed: <span class="inline_code">{"table": ["border"]}</span>.</p>
<p>The <span class="inline_code">replace</span> parameter defines how HTML elements are replaced with other characters to improve plain text layout. It is a dictionary of <span class="inline_code">tag</span> → <span class="inline_code">(before, after)</span> items. The default <span class="inline_code">blocks</span> dictionary replaces block elements (<span class="inline_code">&lt;h1&gt;</span>, <span class="inline_code">&nbsp;</span><span class="inline_code">&lt;h2&gt;</span>, <span class="inline_code">&nbsp;</span><span class="inline_code">&lt;p&gt;</span>, <span class="inline_code">&nbsp;</span><span class="inline_code">&lt;div&gt;</span>, <span class="inline_code">&nbsp;</span><span class="inline_code">&lt;table&gt;</span>, ...) with two linebreaks after, <span class="inline_code">&lt;th&gt;</span> and <span class="inline_code">&lt;tr&gt;</span> with one linebreak after, <span class="inline_code">&lt;td&gt;</span> with one tab after, <span class="inline_code">&lt;li&gt;</span> with an asterisk (<span class="inline_code">*</span>) before and a linebreak after.</p>
<p>The <span class="inline_code">linebreaks</span> parameter defines the maximum amount of consecutive linebreaks to keep.</p>
<p>The <span class="inline_code">indentation</span> parameter defines whether or not to keep tab indentation.</p>
<p>For  example, the following script downloads a HTML document and keeps only a  minimal amount of formatting (headings, bold, links).</p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> s = URL<span style="">&#40;</span><span style="color: #657a8a;">'http://www.clips.ua.ac.be'</span><span style="">&#41;</span>.<span style="">download</span><span style="">&#40;</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> s = plaintext<span style="">&#40;</span>s, keep=<span style="">&#123;</span><span style="color: #657a8a;">'h1'</span>:<span style="">&#91;</span><span style="">&#93;</span>, <span style="color: #657a8a;">'h2'</span>:<span style="">&#91;</span><span style="">&#93;</span>, <span style="color: #657a8a;">'strong'</span>:<span style="">&#91;</span><span style="">&#93;</span>, <span style="color: #657a8a;">'a'</span>:<span style="">&#91;</span><span style="color: #657a8a;">'href'</span><span style="">&#93;</span><span style="">&#125;</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">print</span> s</code></span></span></p>
<p style="margin-top: 1.3em;"><span class="smallcaps">plaintext = strip + decode + collapse</span></p>
<p>The different steps in <span class="inline_code">plaintext()</span> are also available as separate commands:</p>
<p><span class="geshifilter"><code class="python geshifilter-python">decode_utf8<span style="">&#40;</span><span style="">string</span><span style="">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Byte string to Unicode string.</span></code></span><span class="geshifilter"><code class="python geshifilter-python">encode_utf8<span style="">&#40;</span><span style="">string</span><span style="">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Unicode string to byte string.</span></code></span></p>
<p><span class="geshifilter"><code class="python geshifilter-python">strip_tags<span style="">&#40;</span>html, keep=<span style="">&#91;</span><span style="">&#93;</span>, replace=blocks<span style="">&#41;</span> <span style="color: grey;"># Non-trivial, using SGML parser.</span></code></span></p>
<p><span class="geshifilter"><code class="python geshifilter-python">strip_between<span style="">&#40;</span>a, b, <span style="">string</span><span style="">&#41;</span> <span style="color: grey;"># Remove anything between (and including) a and b.</span></code></span></p>
<p><span class="geshifilter"><code class="python geshifilter-python">strip_javascript<span style="">&#40;</span>html<span style="">&#41;</span> &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Strips between '&lt;script*&gt;' and '&lt;/script'.</span></code></span><span class="geshifilter"><code class="python geshifilter-python">strip_inline_css<span style="">&#40;</span>html<span style="">&#41;</span> &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Strips between '&lt;style*&gt;' and '&lt;/style&gt;'.</span></code></span><span class="geshifilter"><code class="python geshifilter-python">strip_comments<span style="">&#40;</span>html<span style="">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Strips between '&lt;!--' and '--&gt;'.</span></code></span><span class="geshifilter"><code class="python geshifilter-python">strip_forms<span style="">&#40;</span>html<span style="">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Strips between '&lt;form*&gt;' and '&lt;/form&gt;'.</span></code></span><span class="geshifilter"><code class="python geshifilter-python">decode_entities<span style="">&#40;</span><span style="">string</span><span style="">&#41;</span> &nbsp; &nbsp; <span style="color: grey;"># '&amp;lt;' =&gt; '&lt;'</span></code></span><span class="geshifilter"><code class="python geshifilter-python">encode_entities<span style="">&#40;</span><span style="">string</span><span style="">&#41;</span> &nbsp; &nbsp; <span style="color: grey;"># '&lt;' =&gt; '&amp;lt;'</span></code></span><span class="geshifilter"><code class="python geshifilter-python">collapse_spaces<span style="">&#40;</span><span style="">string</span><span style="">&#41;</span> &nbsp; &nbsp; <span style="color: grey;"># ' &nbsp; ' =&gt; ' '</span></code></span><span class="geshifilter"><code class="python geshifilter-python">collapse_linebreaks<span style="">&#40;</span><span style="">string</span>, threshold=<span style="color: #666;">1</span><span style="">&#41;</span></code></span><span class="geshifilter"><code class="python geshifilter-python">collapse_tabs<span style="">&#40;</span><span style="">string</span>, indentation=<span style="color: #4a587c;">False</span><span style="">&#41;</span></code></span></p>
<p>&nbsp;</p>
<hr />
<h2><span class="example"><a name="DOM"></a>HTML DOM parser<br /></span></h2>
<p>The <em>Document Object Model</em> (DOM) is a cross-platform and language-independent convention for representing and interacting with objects in HTML, XHTML and XML documents. The web module includes a HTML DOM parser (Leonard Richardson's <a href="http://www.crummy.com/software/BeautifulSoup/" target="_blank">BeautifulSoup</a>), that allows you to traverse a HTML document as a tree of linked Python objects. This is useful to extract specific portions from a HTML string retrieved with <span class="inline_code">URL.download()</span>.</p>
<h3>Node</h3>
<p>The DOM consists of a <span class="inline_code">Document</span> object that contains <span class="inline_code">Text</span>, <span class="inline_code">Comment</span> and <span class="inline_code">Element</span> objects.<br />All of these are subclasses of <span class="inline_code">Node</span>.</p>
<p><span class="geshifilter"><code class="python geshifilter-python">node = Node<span style="">&#40;</span>html, type=NODE<span style="">&#41;</span></code></span><span class="geshifilter"><code class="python geshifilter-python">node.<span style="">type</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># NODE | TEXT | COMMENT | ELEMENT | DOCUMENT</span><br />
node.<span style="">source</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># HTML source.</span><br />
node.<span style="">parent</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Parent node.</span><br />
node.<span style="">children</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># List of child nodes.</span><br />
node.<span style="">next</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Next child in node.parent (or None).</span><br />
node.<span style="">previous</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Previous child in node.parent (or None).</span></code></span><span class="geshifilter"><code class="python geshifilter-python">node.<span style="">traverse</span><span style="">&#40;</span>visit=<span style="color: #28334f; font-weight: bold;">lambda</span> node: <span style="color: #4a587c;">None</span><span style="">&#41;</span></code></span></p>
<h3>Element</h3>
<p><span class="inline_code">Text</span>, <span class="inline_code">Comment</span> and <span class="inline_code">Element</span> are subclasses of <span class="inline_code">Node</span>. For example: <span class="inline_code">'the &lt;b&gt;cat&lt;/b&gt;'</span> is parsed to <span class="inline_code">Text('the')</span> + <span class="inline_code">Element('cat', tag='b')</span>. The <span class="inline_code">Element</span> object has a number of additional properties:</p>
<p><span class="geshifilter"><code class="python geshifilter-python">element = Element<span style="">&#40;</span>html<span style="">&#41;</span></code></span><span class="geshifilter"><code class="python geshifilter-python">element.<span style="">tag</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Tag name.</span><br />
element.<span style="">attributes</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Dictionary of attributes, e.g. {'class':'menu'}.</span><br />
element.<span style="color: #4a587c;">id</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Value for id attribute (or None).</span></code></span><span class="geshifilter"><code class="python geshifilter-python">element.<span style="">source</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># HTML source.</span><br />
element.<span style="">content</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># HTML source minus open and close tag.</span></code></span><span class="geshifilter"><code class="python geshifilter-python">element.<span style="">by_id</span><span style="">&#40;</span><span style="color: #4a587c;">str</span><span style="">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># First nested Element with given id.</span><br />
element.<span style="">by_tag</span><span style="">&#40;</span><span style="color: #4a587c;">str</span><span style="">&#41;</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># List of nested Elements with given tag name.</span><br />
element.<span style="">by_class</span><span style="">&#40;</span><span style="color: #4a587c;">str</span><span style="">&#41;</span> &nbsp; &nbsp; &nbsp; <span style="color: grey;"># List of nested Elements with given class.</span><br />
element.<span style="">by_attribute</span><span style="">&#40;</span><span style="">**</span>kwargs<span style="">&#41;</span></code></span></p>
<ul>
<li><span class="inline_code">Element.by_tag()</span> values can include a class (e.g. <span class="inline_code">"div.header"</span>) or an id (e.g. <span class="inline_code">"div#content"</span>). <br />A wildcard can be used to match any tag. (e.g. <span class="inline_code">"*.even"</span>).<br />The element is searched recursively (children in children, etc.)</li>
<li><span class="inline_code">Element.by_attribute()</span> takes one or more keyword arguments (e.g. <span class="inline_code">name="keywords"</span>).</li>
</ul>
<h3>Document</h3>
<p>The top-level element in the DOM.</p>
<p><span class="geshifilter"><code class="python geshifilter-python">dom = Document<span style="">&#40;</span>html<span style="">&#41;</span></code></span><span class="geshifilter"><code class="python geshifilter-python">dom.<span style="">head</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># &lt;head&gt; Element.</span><br />
dom.<span style="">body</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># &lt;body&gt; Element.</span></code></span></p>
<p>For example, the following script retrieves the last three entries from <a href="http://www.reddit.com/" target="_blank">reddit</a>. The web module does not include a reddit search engine, but we can parse entries directly from the HTML source. This is called <em>screen scraping</em>, and many websites will strongly dislike it (server pressure).</p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> url = URL<span style="">&#40;</span><span style="color: #657a8a;">'http://www.reddit.com/top/'</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> dom = Document<span style="">&#40;</span>url.<span style="">download</span><span style="">&#40;</span>cached=<span style="color: #4a587c;">True</span><span style="">&#41;</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">for</span> e <span style="color: #28334f; font-weight: bold;">in</span> dom.<span style="">by_tag</span><span style="">&#40;</span><span style="color: #657a8a;">'div.entry'</span><span style="">&#41;</span><span style="">&#91;</span>:<span style="color: #666;">3</span><span style="">&#93;</span>: <span style="color: grey;"># Top 3 reddit entries.</span><br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; <span style="color: #28334f; font-weight: bold;">for</span> a <span style="color: #28334f; font-weight: bold;">in</span> e.<span style="">by_tag</span><span style="">&#40;</span><span style="color: #657a8a;">'a.title'</span><span style="">&#41;</span><span style="">&#91;</span>:<span style="color: #666;">1</span><span style="">&#93;</span>: <span style="color: grey;"># First &lt;a class=&quot;title&quot;&gt;.</span><br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #28334f; font-weight: bold;">print</span> <span style="color: #4a587c;">repr</span><span style="">&#40;</span>plaintext<span style="">&#40;</span>a.<span style="">content</span><span style="">&#41;</span><span style="">&#41;</span><br />
<br />
u<span style="color: #657a8a;">'Invisible Kitty'</span><br />
u<span style="color: #657a8a;">'Naturally, he said yes.'</span><br />
u<span style="color: #657a8a;">&quot;I'd just like to remind everyone that /r/minecraft exists and not everyone wants to have 10 Minecraft posts a day on their front page.&quot;</span></code></span></span></p>
<p><span class="smallcaps"><br />Absolute url's</span></p>
<p>Links parsed from the <span class="inline_code">Document</span> may be relative (e.g., starting with <span class="inline_code">"../"</span> instead of <span class="inline_code">"http://"</span>. <br />To get the absolute URL, you can use the <span class="inline_code">abs()</span> function in combination with <span class="inline_code">URL.redirect</span>:</p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">from</span> pattern.<span style="">web</span> <span style="color: #28334f; font-weight: bold;">import</span> <span style="color: #4a587c;">abs</span>, base<br />
<span style="">&gt;&gt;&gt;</span> url = URL<span style="">&#40;</span><span style="color: #657a8a;">'http://nodebox.net'</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> dom = Document<span style="">&#40;</span>url.<span style="">download</span><span style="">&#40;</span><span style="">&#41;</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">for</span> link <span style="color: #28334f; font-weight: bold;">in</span> dom.<span style="">by_tag</span><span style="">&#40;</span><span style="color: #657a8a;">'a'</span><span style="">&#41;</span>:<br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; <span style="color: #28334f; font-weight: bold;">print</span> <span style="color: #4a587c;">abs</span><span style="">&#40;</span>link.<span style="">attributes</span>.<span style="">get</span><span style="">&#40;</span><span style="color: #657a8a;">'href'</span>,<span style="color: #657a8a;">''</span><span style="">&#41;</span>, base=url.<span style="">redirect</span> <span style="color: #28334f; font-weight: bold;">or</span> url.<span style="">string</span><span style="">&#41;</span> </code></span></span></p>
<p>&nbsp;</p>
<hr />
<h2><a name="pdf"></a>PDF Parser</h2>
<p style="margin-top: 0.2em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px;"><em>Portable Document Format</em>&nbsp;(PDF) is a popular open standard for document exchange. The text, fonts, images and layout are contained in a single document that displays the same across systems. However, extracting the source text from a PDF is a non-trivial matter.</p>
<p style="margin-top: 0.2em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px;">The <span class="inline_code">PDF</span> object (based on <a href="http://www.unixuser.org/~euske/python/pdfminer/" target="_self">PDFMiner</a>) parses the source text from a PDF file. This is useful for mining the text, not so much for displaying it (i.e., formatting is lost and some passages may have become garbled).</p>
<p style="margin-top: 0.2em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px;"><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">from</span> pattern.<span style="">web</span> <span style="color: #28334f; font-weight: bold;">import</span> URL, PDF<br />
<span style="">&gt;&gt;&gt;</span> url = URL<span style="">&#40;</span><span style="color: #657a8a;">'http://www.clips.ua.ac.be/sites/default/files/ctrs-002_0.pdf'</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> pdf = PDF<span style="">&#40;</span>url.<span style="">download</span><span style="">&#40;</span><span style="">&#41;</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">print</span> pdf.<span style="">string</span><br />
<br />
CLiPS Technical Report series 002 September <span style="color: #666;">7</span>, <span style="color: #666;">2010</span><br />
Tom De Smedt, Vincent Van Asch, Walter Daelemans <br />
Computational Linguistics <span style="">&amp;</span> Psycholinguistics Research Center<br />
... </code></span></span></p>
<p style="margin-top: 0.2em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px;">URL's linking to a PDF document can be identified with&nbsp;<span class="inline_code">URL.mimetype == MIMETYPE_PDF</span>.</p>
<p>&nbsp;</p>
<hr />
<h2><a name="spider"></a>Spider</h2>
<p>A <em>web crawler</em> or <em>web spider</em> is used to browse the web in an automatter manner. The <span class="inline_code">Spider</span> class is initialized with a list of URLs. These are then visited by the spider. If they lead to a web page (i.e. HTML), the content is parsed for new links. These are added to the list of links scheduled for a visit.</p>
<p>The given <span class="inline_code">delay</span> defines the amount of seconds to wait before revisiting the same (sub)domain. This is a politeness policy: continually hammering a server with a robot disrupts requests from the website's regular visitors (this is called a <em>denial-of-service attack</em>). With <span class="inline_code">queue=False</span>, the spider will skip the link for now, until the delay has passed. With <span class="inline_code">queue=True</span>, the spider remains idle until the delay has passed.</p>
<p><span class="geshifilter"><code class="python geshifilter-python">spider = Spider<span style="">&#40;</span>links=<span style="">&#91;</span><span style="">&#93;</span>, delay=<span style="color: #666;">20.0</span>, queue=<span style="color: #4a587c;">False</span>, <span style="">parser</span>=HTMLLinkParser<span style="">&#40;</span><span style="">&#41;</span>.<span style="">parse</span><span style="">&#41;</span></code></span><span class="geshifilter"><code class="python geshifilter-python">spider.<span style="">delay</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Delay between visits to the same (sub)domain.</span><br />
spider.<span style="">queue</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Wait for delay or parse other links in the meantime?</span><br />
spider.<span style="">visited</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Dictionary of URLs already visited.</span><br />
spider.<span style="">parse</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Function, returns list of Links from a HTML string.</span><br />
spider.<span style="">links</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># List of Links scheduled to visit (read-only).</span><br />
spider.<span style="">done</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># True =&gt; len(Spider.links)==0.</span></code></span><span class="geshifilter"><code class="python geshifilter-python">spider.<span style="">crawl</span><span style="">&#40;</span>method=DEPTH<span style="">&#41;</span> &nbsp;<span style="color: grey;"># DEPTH | BREADTH | None, or custom Spider.rank().</span></code></span><span class="geshifilter"><code class="python geshifilter-python">spider.<span style="">rank</span><span style="">&#40;</span>link, referrer=<span style="color: #4a587c;">None</span><span style="">&#41;</span><br />
spider.<span style="">follow</span><span style="">&#40;</span>link, referrer=<span style="color: #4a587c;">None</span><span style="">&#41;</span><br />
spider.<span style="">visit</span><span style="">&#40;</span>link, referrer=<span style="color: #4a587c;">None</span>, source=<span style="color: #4a587c;">None</span><span style="">&#41;</span><br />
spider.<span style="">fail</span><span style="">&#40;</span>link, referrer=<span style="color: #4a587c;">None</span><span style="">&#41;</span></code></span><span class="geshifilter"><code class="python geshifilter-python">spider.<span style="">normalize</span><span style="">&#40;</span>url<span style="">&#41;</span><br />
spider.<span style="">backlinks</span><span style="">&#40;</span>url<span style="">&#41;</span> &nbsp; &nbsp; &nbsp; <span style="color: grey;"># External incoming links count.</span></code></span></p>
<p><span class="smallcaps">Crawling process</span></p>
<ul>
<li><span class="inline_code">Spider.crawl()</span>&nbsp;is meant to be called continuously in a loop.&nbsp;&nbsp;It&nbsp;selects a link to visit, and parses its content for new links. The default parser is a robust <span class="inline_code">HTMLLinkParser</span> based on Python's <span class="inline_code">sgmllib.SGMLParser</span>.&nbsp;&nbsp;The <span class="inline_code">method</span> parameter specifies whether the spider prefers to visit internal links (<span class="inline_code">DEPTH</span>) or external links to other domains (<span class="inline_code">BREADTH</span>).&nbsp;If the spider is queueing (see&nbsp;<span class="inline_code" style="font-family: Courier, monospace; font-size: 12px;">delay</span>&nbsp;and&nbsp;<span class="inline_code" style="font-family: Courier, monospace; font-size: 12px;">queue</span>&nbsp;above),&nbsp;<span class="inline_code" style="font-family: Courier, monospace; font-size: 12px;">Spider.crawl()</span>&nbsp;does nothing.</li>
</ul>
<ul>
<li><span class="inline_code">Spider.rank()</span> is called from <span class="inline_code">Spider.crawl()</span> to determine the priority of a new <span class="inline_code">Link</span>, as a number between <span class="inline_code">0.0-1.0</span>. Links with higher priority are visited first.&nbsp;<span class="inline_code" style="font-family: Courier, monospace; font-size: 12px;">Spider.rank()</span>&nbsp;can be overridden in a subclass, for example to demote URLs with a query string (that could just be another sort order).&nbsp;Each URL is passed through&nbsp;<span class="inline_code" style="font-family: Courier, monospace; font-size: 12px;">Spider.normalize()</span>which can also be overridden (for example, to strip the query string entirely).</li>
</ul>
<ul>
<li><span class="inline_code">Spider.follow()</span> is called from <span class="inline_code">Spider.crawl()</span> to determine if it should visit the given <span class="inline_code">Link</span>. By default it yields <span class="inline_code">True</span>, but it can be overridden to disallow selected links.</li>
</ul>
<ul>
<li><span class="inline_code">Spider.visit()</span> is called from <span class="inline_code">Spider.crawl()</span> once a <span class="inline_code">Link</span> is visited. When <span class="inline_code">source=None</span>, this means that the link is not a web page (and no HTML was parsed), or possibly that a <span class="inline_code">URLTimeout</span> error occured (content size too big). Otherwise it is the HTML source string. By default this method does nothing, but it can be overridden.</li>
</ul>
<ul>
<li><span class="inline_code">Spider.fail()</span> is called from <span class="inline_code">Spider.crawl()</span> for links whose MIME-type could not be determined or which raised a <span class="inline_code">URLError</span> on download.</li>
</ul>
<p>The spider uses <span class="inline_code">Link</span> objects internally, which hold additional information besides the URL string:</p>
<p><span class="geshifilter"><code class="python geshifilter-python">link = Link<span style="">&#40;</span>url, description=<span style="color: #657a8a;">''</span>, relation=<span style="color: #657a8a;">''</span><span style="">&#41;</span></code></span><span class="geshifilter"><code class="python geshifilter-python">link.<span style="">url</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Parsed from &lt;a href=''&gt; attribute.</span><br />
link.<span style="">description</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Parsed from &lt;a title=''&gt; attribute.</span><br />
link.<span style="">relation</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Parsed from &lt;a rel=''&gt; attribute.</span></code></span></p>
<p>For example, here is a subclass of <span class="inline_code">Spider</span> that simply prints each link it visits. Since it uses <span class="inline_code">DEPTH</span> for crawling, it will prefer website internal links.</p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">class</span> <span style="color:rgb(90, 150, 200)">Spiderling</span><span style="">&#40;</span>Spider<span style="">&#41;</span>: <br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; <span style="color: #28334f; font-weight: bold;">def</span> <span style="color:rgb(90, 150, 200)">visit</span><span style="">&#40;</span><span style="color: #4a587c;">self</span>, link, referrer=<span style="color: #4a587c;">None</span>, source=<span style="color: #4a587c;">None</span><span style="">&#41;</span>:<br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #28334f; font-weight: bold;">print</span> <span style="color: #657a8a;">&quot;visited:&quot;</span>, <span style="color: #4a587c;">repr</span><span style="">&#40;</span>link.<span style="">url</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; <span style="color: #28334f; font-weight: bold;">def</span> <span style="color:rgb(90, 150, 200)">fail</span><span style="">&#40;</span><span style="color: #4a587c;">self</span>, link, referrer=<span style="color: #4a587c;">None</span><span style="">&#41;</span>:<br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #28334f; font-weight: bold;">print</span> <span style="color: #657a8a;">&quot;failed:&quot;</span>, <span style="color: #4a587c;">repr</span><span style="">&#40;</span>link.<span style="">url</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span><br />
<span style="">&gt;&gt;&gt;</span> s = Spiderling<span style="">&#40;</span>links=<span style="">&#91;</span><span style="color: #657a8a;">'http://www.clips.ua.ac.be/'</span><span style="">&#93;</span>, delay=<span style="color: #666;">5</span>, queue=<span style="color: #4a587c;">True</span><span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">while</span> <span style="color: #28334f; font-weight: bold;">not</span> s.<span style="">done</span>:<br />
<span style="">&gt;&gt;&gt;</span> &nbsp; &nbsp; s.<span style="">crawl</span><span style="">&#40;</span>method=DEPTH, cached=<span style="color: #4a587c;">False</span><span style="">&#41;</span><br />
<br />
visited: u<span style="color: #657a8a;">'http://www.clips.ua.ac.be/'</span><br />
visited: u<span style="color: #657a8a;">'http://www.clips.ua.ac.be/#navigation'</span><br />
visited: u<span style="color: #657a8a;">'http://www.clips.ua.ac.be/colloquia'</span><br />
visited: u<span style="color: #657a8a;">'http://www.clips.ua.ac.be/computational-linguistics'</span><br />
visited: u<span style="color: #657a8a;">'http://www.clips.ua.ac.be/contact'</span></code></span></span></p>
<p><span class="small"><span style="text-decoration: underline;">Note</span>: <span class="inline_code">Spider.crawl()</span> takes the same optional parameters as <span class="inline_code">URL.download()</span>, e.g. </span><span class="small"><span class="inline_code">cached=False</span>.</span></p>
<p>&nbsp;</p>
<hr />
<h2><a name="mail"></a>E-mail</h2>
<p>The <em>Internet Message Access Protocol </em>(IMAP) is a protocol for retrieving e-mail messages from a mail server or webmail service.<em> </em>The <span class="inline_code">Mail</span> object is a wrapper for the Python <span class="inline_code">imaplib</span>. It can be used to search + read e-mail messages from your webmail.</p>
<p>Currently, it supports one service: <span class="inline_code">GMAIL</span>. However, it may work with other SSL services by passing the server address to the <span class="inline_code">service</span> parameter (e.g. <span class="inline_code">service="imap.gmail.com"</span>). Note that you need to <a href="http://mail.google.com/support/bin/answer.py?answer=77695" target="_blank">enable IMAP</a> from your Gmail account if you want to access it.</p>
<p><span class="geshifilter"><code class="python geshifilter-python">mail = Mail<span style="">&#40;</span>username, password, service=GMAIL, port=<span style="color: #666;">993</span><span style="">&#41;</span></code></span><span class="geshifilter"><code class="python geshifilter-python">mail.<span style="">folders</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Dictionary of name =&gt; MailFolder.</span><br />
mail.<span style="">&#91;</span>folder<span style="">&#93;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># For example: Mail.inbox.read(i)</span><br />
mail.<span style="">&#91;</span>folder<span style="">&#93;</span>.<span style="">count</span> &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Number of messages in folder.</span></code></span></p>
<p><span class="geshifilter"><code class="python geshifilter-python">mail.<span style="">&#91;</span>folder<span style="">&#93;</span>.<span style="">search</span><span style="">&#40;</span>query, field=FROM<span style="">&#41;</span> <span style="color: grey;"># FROM | SUBJECT | DATE</span><br />
mail.<span style="">&#91;</span>folder<span style="">&#93;</span>.<span style="">read</span><span style="">&#40;</span>index, attachments=<span style="color: #4a587c;">False</span>, cached=<span style="color: #4a587c;">True</span><span style="">&#41;</span></code></span></p>
<p>E-mail messages are organized in folders. The Mail.folders is a <span class="inline_code">name</span> → <span class="inline_code">MailFolder</span> dictionary. Folders can also be accessed directly by name, as an attribute. Common names include: <span class="inline_code">inbox</span>, <span class="inline_code">spam</span>, <span class="inline_code">trash</span>.<span class="inline_code">&nbsp;</span></p>
<p><span class="inline_code">MailFolder.search()</span> returns a list of e-mail indices, latest-first.<span class="inline_code"><br />MailFolder.read()</span> retrieves the e-mail with given index as a <span class="inline_code">Message</span>:</p>
<p><span class="geshifilter"><code class="python geshifilter-python">message = Mail.<span style="">&#91;</span>folder<span style="">&#93;</span>.<span style="">read</span><span style="">&#40;</span>i<span style="">&#41;</span></code></span><span class="geshifilter"><code class="python geshifilter-python">message.<span style="">author</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Unicode string, sender name + e-mail address.</span><br />
message.<span style="">email_address</span> &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Unicode string, sender e-mail address.</span><br />
message.<span style="">date</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Unicode string, date received.</span><br />
message.<span style="">subject</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># Unicode string, message subject.</span><br />
message.<span style="">body</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: grey;"># Unicode string, message body.</span><br />
message.<span style="">attachments</span> &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: grey;"># List of (MIME-type, str)-tuples.</span></code></span></p>
<p>For example:</p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">from</span> pattern.<span style="">web</span> <span style="color: #28334f; font-weight: bold;">import</span> Mail, GMAIL, SUBJECT<br />
<span style="">&gt;&gt;&gt;</span> gmail = Mail<span style="">&#40;</span>username=<span style="color: #657a8a;">'me'</span>, password=<span style="color: #657a8a;">'secret'</span>, service=GMAIL<span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">print</span> gmail.<span style="">folders</span>.<span style="">keys</span><span style="">&#40;</span><span style="">&#41;</span><br />
<br />
<span style="">&#91;</span><span style="color: #657a8a;">'drafts'</span>, <span style="color: #657a8a;">'spam'</span>, <span style="color: #657a8a;">'personal'</span>, <span style="color: #657a8a;">'work'</span>, <span style="color: #657a8a;">'inbox'</span>, <span style="color: #657a8a;">'mail'</span>, <span style="color: #657a8a;">'starred'</span>, <span style="color: #657a8a;">'trash'</span><span style="">&#93;</span></code></span></span></p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> i = gmail.<span style="">spam</span>.<span style="">search</span><span style="">&#40;</span><span style="color: #657a8a;">'wish'</span>, field=SUBJECT<span style="">&#41;</span><span style="">&#91;</span><span style="color: #666;">0</span><span style="">&#93;</span> <span style="color: grey;"># What riches await...</span><br />
<span style="">&gt;&gt;&gt;</span> m = gmail.<span style="">spam</span>.<span style="">read</span><span style="">&#40;</span>i<span style="">&#41;</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">print</span> <span style="color: #657a8a;">' &nbsp; From:'</span>, m.<span style="">author</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">print</span> <span style="color: #657a8a;">'Subject:'</span>, m.<span style="">subject</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">print</span> <span style="color: #657a8a;">'Message:'</span><br />
<span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">print</span> m.<span style="">body</span><br />
<br />
&nbsp; &nbsp;From: Vegas VIP Clib <span style="">&lt;</span>amllhbmjb@acciongeoda.<span style="">org</span><span style="">&gt;</span><br />
Subject: Your wish has been granted<br />
Message:<br />
No one has claimed our jackpot<span style="">!</span> This i​s your chance to t​ry<span style="">!</span> <br />
http://www.<span style="">top</span>-hot-casino.<span style="">ru</span></code></span></span></p>
<p>&nbsp;</p>
<hr />
<h2><a name="cache"></a>Cache</h2>
<p>By, default, <span class="inline_code">URL.download()</span> and <span class="inline_code">SearchEngine.search()</span> will cache results locally. This way, there is no need to connect to the internet once a query has been cached. Over time the cache can grow quite large, filled with whatever was downloaded – from Wikipedia pages to zip archives.</p>
<p>Emptying it is easy (and permanent):</p>
<p><span class="example"><span class="geshifilter"><code class="python geshifilter-python"><span style="">&gt;&gt;&gt;</span> <span style="color: #28334f; font-weight: bold;">from</span> pattern.<span style="">web</span> <span style="color: #28334f; font-weight: bold;">import</span> cache<br />
<span style="">&gt;&gt;&gt;</span> cache.<span style="">clear</span><span style="">&#40;</span><span style="">&#41;</span></code></span></span></p>
<p>&nbsp;</p>
<hr />
<h2>See also</h2>
<ul>
<li><a href="http://www.crummy.com/software/BeautifulSoup/" target="_blank">BeautifulSoup</a> (BSD): r<span>obust HTML parser for Python.</span></li>
<li><span><a href="http://scrapy.org/" target="_blank">Scrapy</a> (BSD): s</span><span>creen scraping and web crawling with Python.</span></li>
</ul>
</div>
</div></div>
        </div>
    </div>
    </div>
    </div>
    </div>
    </div>
</body>
</html>